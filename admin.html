<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>預約後台 (Email+Password)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <main class="max-w-lg mx-auto mt-10 p-6 bg-white rounded-xl shadow">
    <div class="flex gap-2 mb-4">
      <button id="tabSignIn" class="px-4 py-2 bg-purple-600 text-white rounded">登入</button>
      <button id="tabSignUp" class="px-4 py-2 bg-gray-200 text-gray-700 rounded">註冊</button>
    </div>

    <!-- Sign In -->
    <form id="formSignIn" class="space-y-3">
      <input id="inEmail" type="email" placeholder="Email" required class="w-full border p-2 rounded" />
      <input id="inPass" type="password" placeholder="密碼" required class="w-full border p-2 rounded" />
      <button class="w-full bg-purple-600 text-white p-2 rounded">登入</button>
    </form>

    <!-- Sign Up -->
    <form id="formSignUp" class="space-y-3 hidden">
      <input id="upEmail" type="email" placeholder="Email" required class="w-full border p-2 rounded" />
      <input id="upPass" type="password" placeholder="密碼" required class="w-full border p-2 rounded" />
      <button class="w-full bg-green-600 text-white p-2 rounded">註冊</button>
    </form>

    <p id="authMsg" class="text-sm text-red-600 mt-3"></p>
  </main>

  <section id="dashboard" class="hidden max-w-2xl mx-auto mt-10 p-6 bg-white rounded-xl shadow">
    <h2 class="text-xl font-bold mb-4">歡迎進入後台</h2>
    <p>這裡會顯示 bookings 管理表。</p>
    <button id="btnSignOut" class="mt-4 px-4 py-2 bg-gray-200 rounded">登出</button>
  </section>

  <script>
    const supabase = window.supabase.createClient("https://cbebpuqfkprhamwsbhdb.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiZWJwdXFma3ByaGFtd3NiaGRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NjAxODYsImV4cCI6MjA3MjUzNjE4Nn0.GceaTOKGxBb8kCERfw9-k_KsPGnrA_8pXwBaYFar99g");

    const tabSignIn = document.getElementById('tabSignIn');
    const tabSignUp = document.getElementById('tabSignUp');
    const formSignIn = document.getElementById('formSignIn');
    const formSignUp = document.getElementById('formSignUp');
    const authMsg = document.getElementById('authMsg');
    const dashboard = document.getElementById('dashboard');
    const btnSignOut = document.getElementById('btnSignOut');

    // 切換 tab
    tabSignIn.onclick = () => {
      formSignIn.classList.remove('hidden');
      formSignUp.classList.add('hidden');
      tabSignIn.className="px-4 py-2 bg-purple-600 text-white rounded";
      tabSignUp.className="px-4 py-2 bg-gray-200 text-gray-700 rounded";
    };
    tabSignUp.onclick = () => {
      formSignUp.classList.remove('hidden');
      formSignIn.classList.add('hidden');
      tabSignUp.className="px-4 py-2 bg-purple-600 text-white rounded";
      tabSignIn.className="px-4 py-2 bg-gray-200 text-gray-700 rounded";
    };

    // 登入
    formSignIn.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('inEmail').value;
      const password = document.getElementById('inPass').value;
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) authMsg.textContent = "登入失敗：" + error.message;
      else showDashboard();
    });

    // 註冊
    formSignUp.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('upEmail').value;
      const password = document.getElementById('upPass').value;
      const { error } = await supabase.auth.signUp({ email, password });
      if (error) authMsg.textContent = "註冊失敗：" + error.message;
      else authMsg.textContent = "註冊成功，請檢查 Email 確認信後再登入。";
    });

    btnSignOut.addEventListener('click', async () => {
      await supabase.auth.signOut();
      dashboard.classList.add('hidden');
      formSignIn.parentElement.classList.remove('hidden');
    });

    function showDashboard() {
      document.querySelector('main').classList.add('hidden');
      dashboard.classList.remove('hidden');
    }
  </script>
</body>
</html>
